Turbo Assembler	 Version 4.1	    03/15/20 21:39:44	    Page 1
new09.asm



      1				     .186
      2	0000			     .model tiny
      3	0000			     .code
      4				     org 100h
      5
      6				     locals  @@
      7
      8				     public  Old09
      9				     public  New09
     10				     public  MATRIX
     11
     12				     extrn   framedr :proc
     13				     extrn   printl  :proc
     14
     15				     extrn   EndLabel
     16
     17				     ;=================================================
     18				     ; New int 09h that	turn matrix on and off
     19				     ;=================================================
     20
     21	0100			     New09	     proc
     22
     23	0100  50 53 51 52 57 56	06		     push    ax	bx cx dx di si es
     24
     25	0107  E4 60				     in	     al, 60h
     26	0109  2E: 80 3E	0194r 00		     cmp     cs:MATRIX,	0
     27	010F  75 2E				     jne     cs:@@GOOUT
     28
     29	0111  3C 3A				     cmp     al, 3ah	     ;capsLock
     30	0113  75 35				     jne     @@NotYet
     31
     32	0115  2E: C6 06	0194r 01  +		     mov     cs:MATRIX,	1
     33	      90
     34
     35	011C  BF 029C				     mov     di, (80*4+14)*2
     36	011F  B9 0034				     mov     cx, 52d
     37	0122  BA 0009				     mov     dx, 9d
     38	0125  E8 0000e				     call    framedr
     39
     40	0128  BE 0199r				     mov     si, offset	cs:WAKEUP
     41	012B  BF 05E2				     mov     di, (80*9+33)*2
     42	012E  0E				     push    cs
     43	012F  1F				     pop     ds
     44	0130  E8 0000e				     call    printl
     45
     46	0133  2E: C6 06	0194r 01  +		     mov     cs:MATRIX,	1
     47	      90
     48	013A  EB 0E 90 90 90			     jmp     cs:@@NotYet
     49
     50	013F  E8 0021		     @@GOOUT:	     call    checkRed
     51	0142  2E: 80 3E	0194r 01		     cmp     cs:MATRIX,	1
     52	0148  74 00				     je	     cs:@@NotYet
     53
     54	014A  E4 61		     @@NotYet:	     in	     al, 61h
     55	014C  8A E0				     mov     ah, al
     56	014E  0C 80				     or	     al, 80h
     57	0150  E6 61				     out     61h, al
Turbo Assembler	 Version 4.1	    03/15/20 21:39:44	    Page 2
new09.asm



     58	0152  86 C4				     xchg    al, ah
     59	0154  E6 61				     out     61h, al
     60
     61	0156  07 5E 5F 5A 59 5B	58		     pop     es	si di dx cx bx ax
     62
     63	015D  EA				     db	     0eah
     64	015E  0000		     Old09	     dw	     0
     65	0160  0000				     dw	     0
     66
     67	0162  CF				     iret
     68	0163					     endp
     69
     70				     ;=================================================
     71				     ; Checks if typed 'red'
     72				     ; Entry: AL - typed letter
     73				     ; Destr: BX
     74				     ;=================================================
     75
     76	0163			     checkRed	     proc
     77
     78	0163  2E: 8A 1E	0193r			     mov     bl, cs:CURLETTER
     79	0168  B7 00				     mov     bh, 0h
     80	016A  2E: 3A 87	018Dr			     cmp     al, cs:RED[bx]
     81	016F  75 14				     jne     cs:@@WRONGLET
     82
     83	0171  2E: FE 06	0193r			     inc     cs:CURLETTER
     84	0176  2E: 80 3E	0193r 06		     cmp     cs:CURLETTER, 6h
     85	017C  75 0E				     jne     cs:@@ENDCHECK
     86
     87	017E  2E: C6 06	0194r 00  +		     mov     cs:MATRIX,	0h
     88	      90
     89
     90	0185  2E: C6 06	0193r 00  +  @@WRONGLET:     mov     cs:CURLETTER, 0h
     91	      90
     92
     93	018C  C3		     @@ENDCHECK:     ret
     94	018D					     endp
     95
     96	018D  13 93 12 92 20 A0	     RED	     db	     13h, 93h, 12h, 92h, 20h, 0A0h   ;'red' in scancodes
     97	0193  00		     CURLETTER	     db	     0h
     98
     99	0194  00		     MATRIX	     db	     0h
    100
    101	0195  0000		     INTBUF	     dw	     0
    102	0197  0000				     dw	     0
    103
    104	0199  57 41 4B 45 20 55	50+  WAKEUP	     db	     'WAKE UP, NEO', 0h
    105	      2C 20 4E 45 4F 00
    106
    107				     end
Turbo Assembler	 Version 4.1	    03/15/20 21:39:44	    Page 3
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "03/15/20"
??FILENAME			  Text	 "new09	  "
??TIME				  Text	 "21:39:44"
??VERSION			  Number 040A
@32BIT				  Text	 0
@@ENDCHECK			  Near	 DGROUP:018C
@@GOOUT				  Near	 DGROUP:013F
@@NOTYET			  Near	 DGROUP:014A
@@WRONGLET			  Near	 DGROUP:0185
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0103H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 NEW09
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
CHECKRED			  Near	 DGROUP:0163
CURLETTER			  Byte	 DGROUP:0193
ENDLABEL			  Word	 DGROUP:---- Extern
FRAMEDR				  Near	 DGROUP:---- Extern
INTBUF				  Word	 DGROUP:0195
MATRIX				  Byte	 DGROUP:0194
NEW09				  Near	 DGROUP:0100
OLD09				  Word	 DGROUP:015E
PRINTL				  Near	 DGROUP:---- Extern
RED				  Byte	 DGROUP:018D
WAKEUP				  Byte	 DGROUP:0199

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  01A6 Word	  Public  CODE
